<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coach Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="ehcb-icon.png" type="image/png" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <div class="header-flex">
      <img src="wikinger.png" alt="Wikinger-Logo" class="logo desktop-logo" />
      <h1>EHC BIEL-BIENNE U18-ELIT</h1>
      <img src="wikinger.png" alt="Wikinger-Logo" class="logo mobile-logo" />
    </div>
  </header>
  <nav>
    <div class="nav-cards">
      <a href="index.html" class="nav-card">Startseite</a>
      <a href="kalender.html" class="nav-card">MIH Kalender U18</a>
      <a href="https://noudi72.github.io/Cardio-App-EHCB-U18/" class="nav-card" target="_blank">Cardio-Programme</a>
      <a href="https://script.google.com/macros/s/AKfycbzkS395JUZ8Su4uxit44p8dZCKRbGDNs12fjZTdlkx_zKyTNY-9yrvymGuSedxe_pcinw/exec" class="nav-card" target="_blank">Sponser Sport Food</a>
      <a href="https://www.ehcb.ch/de/teams/u18-elit" class="nav-card" target="_blank">Spirit Homepage</a>
      <a href="feedback.html" class="nav-card">Player Feedback</a>
      <a href="dashboard.html" class="nav-card">Coach Dashboard</a>
    </div>
  </nav>
  <main>
    <!-- Login Card -->
    <section class="card" id="login-section" style="max-width:420px;margin:2.7rem auto;">
      <h2 style="color:#002b5c;text-align:center;font-size:1.5rem;margin-bottom:1.6rem;">üîê Coach Login</h2>
      <input type="password" id="password" placeholder="Passwort eingeben" />
      <button onclick="checkPassword()">Login</button>
      <div id="login-msg" class="error"></div>
    </section>

    <!-- Dashboard Card -->
    <section class="card" id="dashboard-section" style="display:none;max-width:1150px;margin:2.7rem auto 2.4rem auto;">
      <div style="display:flex;align-items:center;gap:1.5rem;justify-content:center;margin-bottom:2.5rem;">
        <img src="wikinger.png" alt="EHC Biel Logo" style="height:60px;">
        <h1 style="color:#002b5c;font-size:2.1rem;font-weight:900;margin:0;">üìä Coach Dashboard</h1>
      </div>
      <div class="coach-filter" style="margin-bottom:2.6rem;display:flex;flex-wrap:wrap;align-items:center;gap:1.2rem;justify-content:center;">
        <label for="date-filter" style="font-weight:700;">Date:</label>
        <input type="date" id="date-filter" style="margin-right:1rem;">
        <label for="name-filter" style="font-weight:700;">Player:</label>
        <input type="text" id="name-filter" placeholder="Name" style="width:200px;">
        <button onclick="filterData()" class="btn" style="margin-left:1.2rem;">Filter</button>
      </div>
      <canvas id="performanceChart" style="margin:2rem auto;display:block;max-width:400px;"></canvas>
      <div style="overflow-x:auto;">
        <table id="feedbackTable" style="width:100%;border-radius:10px;overflow:hidden;">
          <thead>
            <tr>
              <th>Date</th><th>Name</th><th>Feeling</th><th>Performance</th><th>Intensity</th><th>Comment</th><th>Delete</th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
      </div>
    </section>
  </main>
  <section class="yellow-slogan">
    "OUR STRENGTH IS OUR UNITY!"
  </section>
  <footer>
    ¬© 2025 EHC Biel-Bienne U18-Elit
  </footer>
  <script>
    const correctPassword = "Coach7274";
    function checkPassword() {
      const input = document.getElementById("password").value;
      const msg = document.getElementById("login-msg");
      if (input === correctPassword) {
        document.getElementById("login-section").style.display = "none";
        document.getElementById("dashboard-section").style.display = "block";
        loadData();
      } else {
        msg.textContent = "‚ùå Falsches Passwort. Bitte versuche es erneut.";
      }
    }
    let rawData = [];
    function loadData() {
      fetch('https://opensheet.elk.sh/1AdcOsjQqNRl8kxY1NZ1kzA9XHyMlhXJB-yoNEo6ikQE/Feedback')
        .then(response => response.json())
        .then(data => {
          rawData = data;
          renderTable(data);
          renderChart(data);
        });
    }
    function renderTable(data) {
      const tbody = document.querySelector("#feedbackTable tbody");
      tbody.innerHTML = "";
      data.forEach((entry, index) => {
        const date = new Date(entry.Date);
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${isNaN(date) ? entry.Date : date.toLocaleString()}</td>
          <td>${entry.Name}</td>
          <td>${entry.Feeling}</td>
          <td>${entry.Performance}</td>
          <td>${entry.Intensity}</td>
          <td>${entry.Comment}</td>
          <td><button class="delete-btn" onclick="deleteEntry(${index})">üóëÔ∏è</button></td>
        `;
        tbody.appendChild(tr);
      });
    }
    function filterData() {
      const dateValue = document.getElementById("date-filter").value;
      const nameValue = document.getElementById("name-filter").value.toLowerCase();
      const filtered = rawData.filter(entry => {
        const matchesDate = !dateValue || entry.Date.startsWith(dateValue);
        const matchesName = !nameValue || entry.Name.toLowerCase().includes(nameValue);
        return matchesDate && matchesName;
      });
      renderTable(filtered);
      renderChart(filtered);
    }
    function deleteEntry(index) {
      rawData.splice(index, 1);
      renderTable(rawData);
      renderChart(rawData);
    }
    function renderChart(data) {
      const ctx = document.getElementById('performanceChart').getContext('2d');
      const labels = [...new Set(data.map(d => d.Performance))];
      const counts = labels.map(val => data.filter(d => d.Performance == val).length);
      if (window.performanceChart) window.performanceChart.destroy();
      window.performanceChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: counts,
            backgroundColor: ['#1abc9c', '#3498db', '#9b59b6', '#e67e22', '#e74c3c'],
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: "#002b5c" } }
          }
        }
      });
    }
  </script>
</body>
</html>