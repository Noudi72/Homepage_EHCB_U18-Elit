<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Coach Dashboard</title>
  <link rel="stylesheet" href="style.css">
  <link rel="icon" href="ehcb-icon.png" type="image/png" />
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
  <header>
    <div class="header-flex">
      <img src="wikinger.png" alt="Wikinger-Logo" class="logo desktop-logo" />
      <h1>EHC BIEL-BIENNE U18-ELIT</h1>
      <img src="wikinger.png" alt="Wikinger-Logo" class="logo mobile-logo" />
    </div>
    <nav>
      <ul class="nav-vertical">
        <li><a href="index.html">Startseite</a></li>
        <li><a href="kalender.html">MIH Kalender U18</a></li>
        <li><a href="feedback.html">Player Feedback</a></li>
        <li><a href="dashboard.html">Coach Dashboard</a></li>
      </ul>
    </nav>
  </header>

  <main>
    <div id="login" class="login-container">
      <div class="login-box">
        <h2>üîê Coach Login</h2>
        <input type="password" id="password" placeholder="Enter password" />
        <br><br>
        <button onclick="checkPassword()">Login</button>
      </div>
    </div>

    <div id="dashboard" class="dashboard" style="display:none;max-width:1200px;margin:2rem auto;">
      <div class="header" style="display:flex;align-items:center;">
        <img src="wikinger.png" alt="EHC Biel Logo" class="logo" style="margin-right:18px;"/>
        <h1 style="color:#002b5c;">üìä Coach Dashboard</h1>
      </div>

      <div class="filter-controls" style="margin-bottom:20px;">
        <label>Date: <input type="date" id="date-filter"></label>
        <label>Player: <input type="text" id="name-filter" placeholder="Name"></label>
        <button onclick="filterData()">Filter</button>
      </div>

      <canvas id="performanceChart" style="margin:2rem 0;"></canvas>
      <table id="feedbackTable" style="width:100%;border-radius:10px;overflow:hidden;">
        <thead>
          <tr>
            <th>Date</th><th>Name</th><th>Feeling</th><th>Performance</th><th>Intensity</th><th>Comment</th><th>Delete</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </main>

  <section class="yellow-slogan">
    <p>"OUR STRENGTH IS OUR UNITY!"</p>
  </section>
  <footer>
    <p>¬© 2025 EHC Biel-Bienne U18-Elit</p>
  </footer>
  <script>
    const correctPassword = "ehcb2025";
    function checkPassword() {
      const input = document.getElementById("password").value;
      if (input === correctPassword) {
        document.getElementById("login").style.display = "none";
        document.getElementById("dashboard").style.display = "block";
        loadData();
      } else {
        alert("Incorrect password");
      }
    }

    let rawData = [];
    function loadData() {
      fetch('https://opensheet.elk.sh/1AdcOsjQqNRl8kxY1NZ1kzA9XHyMlhXJB-yoNEo6ikQE/Feedback')
        .then(response => response.json())
        .then(data => {
          rawData = data;
          renderTable(data);
          renderChart(data);
        });
    }
    function renderTable(data) {
      const tbody = document.querySelector("#feedbackTable tbody");
      tbody.innerHTML = "";
      data.forEach((entry, index) => {
        const date = new Date(entry.Date);
        const tr = document.createElement("tr");
        tr.innerHTML = `
          <td>${isNaN(date) ? entry.Date : date.toLocaleString()}</td>
          <td>${entry.Name}</td>
          <td>${entry.Feeling}</td>
          <td>${entry.Performance}</td>
          <td>${entry.Intensity}</td>
          <td>${entry.Comment}</td>
          <td><button class="delete-btn" onclick="deleteEntry(${index})">üóëÔ∏è</button></td>
        `;
        tbody.appendChild(tr);
      });
    }
    function filterData() {
      const dateValue = document.getElementById("date-filter").value;
      const nameValue = document.getElementById("name-filter").value.toLowerCase();
      const filtered = rawData.filter(entry => {
        const matchesDate = !dateValue || entry.Date.startsWith(dateValue);
        const matchesName = !nameValue || entry.Name.toLowerCase().includes(nameValue);
        return matchesDate && matchesName;
      });
      renderTable(filtered);
      renderChart(filtered);
    }
    function deleteEntry(index) {
      rawData.splice(index, 1);
      renderTable(rawData);
      renderChart(rawData);
    }
    function renderChart(data) {
      const ctx = document.getElementById('performanceChart').getContext('2d');
      const labels = [...new Set(data.map(d => d.Performance))];
      const counts = labels.map(val => data.filter(d => d.Performance == val).length);
      if (window.performanceChart) window.performanceChart.destroy();
      window.performanceChart = new Chart(ctx, {
        type: 'doughnut',
        data: {
          labels: labels,
          datasets: [{
            data: counts,
            backgroundColor: ['#1abc9c', '#3498db', '#9b59b6', '#e67e22', '#e74c3c'],
          }]
        },
        options: {
          plugins: {
            legend: { labels: { color: "#002b5c" } }
          }
        }
      });
    }
  </script>
</body>
</html>